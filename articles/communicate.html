<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Communicate lifecycle changes in your functions • lifecycle</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Communicate lifecycle changes in your functions">
<meta property="og:description" content="lifecycle">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lifecycle</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/stages.html">Lifecycle stages</a>
    </li>
    <li>
      <a href="../articles/manage.html">Manage lifecycle changes in functions you use</a>
    </li>
    <li>
      <a href="../articles/communicate.html">Communicate lifecycle changes in your functions</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Releases</li>
    <li>
      <a href="https://www.tidyverse.org/blog/2021/02/lifecycle-1-0-0/">lifecycle 1.0.0</a>
    </li>
    <li class="divider">
    <li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-lib/lifecycle/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="communicate_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Communicate lifecycle changes in your functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/lifecycle/blob/master/vignettes/communicate.Rmd"><code>vignettes/communicate.Rmd</code></a></small>
      <div class="hidden name"><code>communicate.Rmd</code></div>

    </div>

    
    
<p>lifecycle provides a standard way to document the lifecycle stages of functions and arguments, paired with tools to steer users away from deprecated functions. Before we go in to the details, make sure that you’re familiar with the lifecycle stages as described in <code><a href="../articles/stages.html">vignette("stages")</a></code>.</p>
<div id="basics" class="section level2">
<h2 class="hasAnchor">
<a href="#basics" class="anchor"></a>Basics</h2>
<p>lifecycle badges make it easy for users to see the lifecycle stage when reading the documentation. To use the badges, first call <code>usethis::use_lifecycle()</code> to embed the badge images in your package (you only need to do this once), then use <code><a href="../reference/badge.html">lifecycle::badge()</a></code> to insert a badge:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' `r lifecycle::badge("experimental")`</span>
<span class="co">#' `r lifecycle::badge("deprecated")`</span>
<span class="co">#' `r lifecycle::badge("superseded")`</span></code></pre></div>
<p>Deprecated functions also need to advertise their status when run. lifecycle provides <code><a href="../reference/deprecate_soft.html">deprecate_warn()</a></code> which takes three main arguments:</p>
<ul>
<li><p>The first argument, <code>when</code>, gives the version number when the deprecation occurred.</p></li>
<li><p>The second argument, <code>what</code>, describes exactly what was deprecated.</p></li>
<li><p>The third argument, <code>with</code>, provides the recommended alternative.</p></li>
</ul>
<p>We’ll cover the details shortly, but here are a few sample uses:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/deprecate_soft.html">deprecate_warn</a></span><span class="op">(</span><span class="st">"1.0.0"</span>, <span class="st">"old_fun()"</span>, <span class="st">"new_fun()"</span><span class="op">)</span>
<span class="co">#&gt; Warning: `old_fun()` was deprecated in lifecycle 1.0.0.</span>
<span class="co">#&gt; Please use `new_fun()` instead.</span>
<span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/deprecate_soft.html">deprecate_warn</a></span><span class="op">(</span><span class="st">"1.0.0"</span>, <span class="st">"fun()"</span>, <span class="st">"testthat::fun()"</span><span class="op">)</span>
<span class="co">#&gt; Warning: `fun()` was deprecated in lifecycle 1.0.0.</span>
<span class="co">#&gt; Please use `testthat::fun()` instead.</span>
<span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/deprecate_soft.html">deprecate_warn</a></span><span class="op">(</span><span class="st">"1.0.0"</span>, <span class="st">"fun(old_arg)"</span>, <span class="st">"fun(new_arg)"</span><span class="op">)</span>
<span class="co">#&gt; Warning: The `old_arg` argument of `fun()` is deprecated as of lifecycle 1.0.0.</span>
<span class="co">#&gt; Please use the `new_arg` argument instead.</span></code></pre></div>
<p>(Note that the message includes the package name — this is automatically discovered from the environment of the calling function so will not work unless the function is called from the package namespace.)</p>
<p>The following sections describe how to use lifecycle badges and functions together to handle a variety of common development tasks.</p>
</div>
<div id="functions" class="section level2">
<h2 class="hasAnchor">
<a href="#functions" class="anchor"></a>Functions</h2>
<div id="deprecate-a-function" class="section level3">
<h3 class="hasAnchor">
<a href="#deprecate-a-function" class="anchor"></a>Deprecate a function</h3>
<p>First, add a badge to the the <code>@description</code> block<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. Briefly describe why the deprecation occurred and what to use instead.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Add two numbers</span>
<span class="co">#' </span>
<span class="co">#' @description</span>
<span class="co">#' `r lifecycle::badge("deprecated")</span>
<span class="co">#' </span>
<span class="co">#' This function was deprecated because we realised that it's</span>
<span class="co">#' a special case of the [sum()] function.</span></code></pre></div>
<p>Next, update the examples to show how to convert from the old usage to the new usage:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' @examples </span>
<span class="co">#' add_two(1, 2)</span>
<span class="co">#' # -&gt;</span>
<span class="co">#' sum(1, 2)</span></code></pre></div>
<p>Then add <code>@keywords internal</code> to remove the function from the documentation index. If you use pkgdown, also check that it’s no longer listed in <code>_pkgdown.yml</code>. These changes reduce the chance of new users coming across a deprecated function, but don’t prevent those who already know about it from referring to the docs.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' @keywords internal</span></code></pre></div>
<p>You’re now done with the docs, and it’s time to add a warning when the user calls your function. Do this by adding call to <code><a href="../reference/deprecate_soft.html">deprecate_warn()</a></code> on the first line of the function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">add_two</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/deprecate_soft.html">deprecate_warn</a></span><span class="op">(</span><span class="st">"1.0.0"</span>, <span class="st">"add_two()"</span>, <span class="st">"base::sum()"</span><span class="op">)</span>
  <span class="va">x</span> <span class="op">+</span> <span class="va">y</span>
<span class="op">}</span>

<span class="fu">add_two</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; Warning: `add_two()` was deprecated in lifecycle 1.0.0.</span>
<span class="co">#&gt; Please use `base::sum()` instead.</span>
<span class="co">#&gt; [1] 3</span></code></pre></div>
<p><code><a href="../reference/deprecate_soft.html">deprecate_warn()</a></code> generates user friendly messages for two common deprecation alternatives:</p>
<ul>
<li><p>Function in same package: <code><a href="../reference/deprecate_soft.html">lifecycle::deprecate_warn("1.0.0", "fun_old()", "fun_new()")</a></code></p></li>
<li><p>Function in another package: <code><a href="../reference/deprecate_soft.html">lifecycle::deprecate_warn("1.0.0", "old()", "package::new()")</a></code></p></li>
</ul>
<p>For other cases, use the <code>details</code> argument to provide your own message to the user:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">add_two</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/deprecate_soft.html">deprecate_warn</a></span><span class="op">(</span>
    <span class="st">"1.0.0"</span>, 
    <span class="st">"add_two()"</span>, 
    details <span class="op">=</span> <span class="st">"This function is a special case of sum(); use it instead."</span>
  <span class="op">)</span>
  <span class="va">x</span> <span class="op">+</span> <span class="va">y</span>
<span class="op">}</span>

<span class="fu">add_two</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; Warning: `add_two()` was deprecated in lifecycle 1.0.0.</span>
<span class="co">#&gt; This function is a special case of sum(); use it instead.</span>
<span class="co">#&gt; [1] 3</span></code></pre></div>
<p>It’s good practice to test that you’ve correctly implemented the deprecation, testing that the deprecated function still works and that it generates a useful warning. Using an expectation inside <code><a href="https://testthat.r-lib.org/reference/expect_snapshot.html">testthat::expect_snapshot()</a></code><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> is a convenient way to do this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"add_two is deprecated"</span>, <span class="op">{</span>
  <span class="fu"><a href="https://testthat.r-lib.org/reference/expect_snapshot.html">expect_snapshot</a></span><span class="op">(</span><span class="op">{</span>
    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">add_two</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>
    <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>If you have existing tests for the deprecated function you can suppress the warning in those tests with the <code>lifecycle_verbosity</code> option:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"add_two returns the sum of its inputs"</span>, <span class="op">{</span>
  <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html">local_options</a></span><span class="op">(</span>lifecycle_verbosity <span class="op">=</span> <span class="st">"quiet"</span><span class="op">)</span>
  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fu">add_two</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>And then add a separate test specifically for the deprecation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html">test_that</a></span><span class="op">(</span><span class="st">"add_two is deprecated"</span>, <span class="op">{</span>
  <span class="fu"><a href="https://testthat.r-lib.org/reference/expect_snapshot.html">expect_snapshot</a></span><span class="op">(</span><span class="fu">add_two</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
</div>
<div id="gradual-deprecation" class="section level3">
<h3 class="hasAnchor">
<a href="#gradual-deprecation" class="anchor"></a>Gradual deprecation</h3>
<p>For particularly important functions, you can choose to add two other stages to the deprecation process:</p>
<ul>
<li><p><code>deprecated_soft()</code> is used before <code>deprecated_warn()</code>. This function only warns (a) users who try the feature from the global environment and (b) developers who directly use the feature (when running testthat tests). There is no warning when the deprecated feature is called indirectly by another package — the goal is to ensure that warn only the person who has the power to stop using the deprecated feature.</p></li>
<li><p><code>deprecated_stop()</code> comes after <code>deprecated_warn()</code> and generates an error instead of a warning. The main benefit over simply removing the function is that the user is informed about the replacement.</p></li>
</ul>
<p>If you use these stages you’ll also need a process for bumping the deprecation stage for major and minor releases. We recommend something like this:</p>
<ol style="list-style-type: decimal">
<li><p>Search for <code><a href="../reference/deprecate_soft.html">deprecate_stop()</a></code> and consider if you’re ready to the remove the function completely.</p></li>
<li><p>Search for <code><a href="../reference/deprecate_soft.html">deprecate_warn()</a></code> and replace with <code><a href="../reference/deprecate_soft.html">deprecate_stop()</a></code>. Remove the remaining body of the function and any tests.</p></li>
<li><p>Search for <code><a href="../reference/deprecate_soft.html">deprecate_soft()</a></code> and replace with <code><a href="../reference/deprecate_soft.html">deprecate_warn()</a></code>.</p></li>
</ol>
</div>
<div id="rename-a-function" class="section level3">
<h3 class="hasAnchor">
<a href="#rename-a-function" class="anchor"></a>Rename a function</h3>
<p>To rename a function without breaking existing code, move the implementation to the new function, then call the new function from the old function, along with a deprecation message:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Add two numbers</span>
<span class="co">#' </span>
<span class="co">#' @description </span>
<span class="co">#' `r lifecycle::badge(deprecated)`</span>
<span class="co">#' </span>
<span class="co">#' `add_two()` was renamed to `number_add()` to create a more</span>
<span class="co">#' consistent API.</span>
<span class="co">#' @keywords internal</span>
<span class="co">#' @export</span>
<span class="va">add_two</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">foo</span>, <span class="va">bar</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/deprecate_soft.html">deprecate_warn</a></span><span class="op">(</span><span class="st">"1.0.0"</span>, <span class="st">"add_two()"</span>, <span class="st">"number_add()"</span><span class="op">)</span>
  <span class="fu">number_add</span><span class="op">(</span><span class="va">foo</span>, <span class="va">bar</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># documentation goes here...</span>
<span class="co">#' @export</span>
<span class="va">number_add</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">+</span> <span class="va">y</span>
<span class="op">}</span></code></pre></div>
<p>If you are renaming many functions as part of an API overhaul, it’ll often make sense to document all the changes in one file, like <a href="https://rvest.tidyverse.org/reference/rename.html" class="uri">https://rvest.tidyverse.org/reference/rename.html</a>.</p>
</div>
<div id="supersede-a-function" class="section level3">
<h3 class="hasAnchor">
<a href="#supersede-a-function" class="anchor"></a>Supersede a function</h3>
<p>Superseding a function is simpler than deprecating it, since you don’t need to steer users away from it with a warning. So all you need to do is add a superseded badge:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' Gather columns into key-value pairs</span>
<span class="co">#'</span>
<span class="co">#' @description</span>
<span class="co">#' `r lifecycle::badge("superseded")`</span></code></pre></div>
<p>Then describe why the function was superseded, and what the recommended alternative is:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#'</span>
<span class="co">#' Development on `gather()` is complete, and for new code we recommend</span>
<span class="co">#' switching to `pivot_longer()`, which is easier to use, more featureful,</span>
<span class="co">#' and still under active development.</span>
<span class="co">#' </span>
<span class="co">#' In brief,</span>
<span class="co">#' `df %&gt;% gather("key", "value", x, y, z)` is equivalent to</span>
<span class="co">#' `df %&gt;% pivot_longer(c(x, y, z), names_to = "key", values_to = "value")`.</span>
<span class="co">#' See more details in `vignette("pivot")`.</span></code></pre></div>
<p>The rest of the documentation can stay the same.</p>
<p>If you’re willing to live on the bleeding edge of lifecycle, add a call to the experimental <code><a href="../reference/signal_stage.html">signal_stage()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gather</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">key</span> <span class="op">=</span> <span class="st">"key"</span>, <span class="va">value</span> <span class="op">=</span> <span class="st">"value"</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/signal_stage.html">signal_stage</a></span><span class="op">(</span><span class="st">"superseded"</span>, <span class="st">"gather()"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>This signal isn’t currently hooked up to any behaviour, but we plan to provide logging and analysis tools in a future release.</p>
</div>
<div id="mark-function-as-experimental" class="section level3">
<h3 class="hasAnchor">
<a href="#mark-function-as-experimental" class="anchor"></a>Mark function as experimental</h3>
<p>To advertise that a function is experimental and the interface might change in the future, first add an experimental badge to the description:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' @description</span>
<span class="co">#' `r lifecycle::badge("experimental")`</span></code></pre></div>
<p>If the function is very experimental, you might want to add <code>@keywords internal</code> too.</p>
<p>If you’re willing to try an experimental lifecycle feature, add a call to <code><a href="../reference/signal_stage.html">signal_stage()</a></code> in the body:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cool_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/signal_stage.html">signal_stage</a></span><span class="op">(</span><span class="st">"experimental"</span>, <span class="st">"cool_function()"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>This signal isn’t currently hooked up to any behaviour, but we plan to provide logging and analysis tools in a future release.</p>
</div>
</div>
<div id="arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#arguments" class="anchor"></a>Arguments</h2>
<div id="deprecate-an-argument-keeping-the-existing-default" class="section level3">
<h3 class="hasAnchor">
<a href="#deprecate-an-argument-keeping-the-existing-default" class="anchor"></a>Deprecate an argument, keeping the existing default</h3>
<p>Take this example where we want to deprecate <code>na.rm</code> in favour of always making it <code>TRUE.</code></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">add_two</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, na.rm <span class="op">=</span> <span class="va">na.rm</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>First, add a badge to the argument description:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' @param na.rm `r lifecycle::badge("deprecated")` `na.rm = FALSE` is no</span>
<span class="co">#'   longer supported; this function will always remove missing values</span></code></pre></div>
<p>And add a deprecation warning if <code>na.rm</code> is FALSE. In this case, there’s no replacement to the behaviour, so we instead use <code>details</code> to provide a custom message:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">add_two</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">na.rm</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/deprecate_soft.html">deprecate_warn</a></span><span class="op">(</span>
      when <span class="op">=</span> <span class="st">"1.0.0"</span>, 
      what <span class="op">=</span> <span class="st">"add_two(na.rm)"</span>,
      details <span class="op">=</span> <span class="st">"Ability to retain missing values will be dropped in next release."</span>
    <span class="op">)</span>
  <span class="op">}</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, na.rm <span class="op">=</span> <span class="va">na.rm</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">add_two</span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] 1</span>
<span class="fu">add_two</span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Warning: The `na.rm` argument of `add_two()` is deprecated as of lifecycle 1.0.0.</span>
<span class="co">#&gt; Ability to retain missing values will be dropped in next release.</span>
<span class="co">#&gt; [1] NA</span></code></pre></div>
</div>
<div id="deprecating-an-argument-providing-a-new-default" class="section level3">
<h3 class="hasAnchor">
<a href="#deprecating-an-argument-providing-a-new-default" class="anchor"></a>Deprecating an argument, providing a new default</h3>
<p>Alternatively, you can change the default value to <code><a href="../reference/deprecated.html">lifecycle::deprecated()</a></code> to make the deprecation status more obvious from the outside, and use <code><a href="../reference/deprecated.html">lifecycle::is_present()</a></code> to test whether or not the argument was provided. Unlike <code><a href="https://rdrr.io/r/base/missing.html">missing()</a></code>, this works for both direct and indirect calls.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' @importFrom lifecycle deprecated</span>
<span class="va">add_two</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="fu"><a href="../reference/deprecated.html">deprecated</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/deprecated.html">is_present</a></span><span class="op">(</span><span class="va">na.rm</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/deprecate_soft.html">deprecate_warn</a></span><span class="op">(</span>
      when <span class="op">=</span> <span class="st">"1.0.0"</span>, 
      what <span class="op">=</span> <span class="st">"add_two(na.rm)"</span>,
      details <span class="op">=</span> <span class="st">"Ability to retain missing values will be dropped in next release."</span>
    <span class="op">)</span>
  <span class="op">}</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, na.rm <span class="op">=</span> <span class="va">na.rm</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The chief advantage of this technique is that users will get a warning regardless of what value of <code>na.rm</code> they use:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">add_two</span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Warning: The `na.rm` argument of `add_two()` is deprecated as of lifecycle 1.0.0.</span>
<span class="co">#&gt; Ability to retain missing values will be dropped in next release.</span>
<span class="co">#&gt; [1] 1</span>
<span class="fu">add_two</span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span>, na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Warning: The `na.rm` argument of `add_two()` is deprecated as of lifecycle 1.0.0.</span>
<span class="co">#&gt; Ability to retain missing values will be dropped in next release.</span>
<span class="co">#&gt; [1] NA</span></code></pre></div>
</div>
<div id="renaming-an-argument" class="section level3">
<h3 class="hasAnchor">
<a href="#renaming-an-argument" class="anchor"></a>Renaming an argument</h3>
<p>You may want to rename an argument if you realise you have made a mistake with the name of an argument. For example, you’ve realised that an argument accidentally uses <code>.</code> to separate a compound name, instead of <code>_</code>. You’ll need to temporarily permit both arguments, generating a deprecation warning when the user supplies the old argument:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">add_two</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">na_rm</span> <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="fu"><a href="../reference/deprecated.html">deprecated</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/deprecated.html">is_present</a></span><span class="op">(</span><span class="va">na.rm</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/deprecate_soft.html">deprecate_warn</a></span><span class="op">(</span><span class="st">"1.0.0"</span>, <span class="st">"add_two(na.rm)"</span>, <span class="st">"add_two(na_rm)"</span><span class="op">)</span>
    <span class="va">na_rm</span> <span class="op">&lt;-</span> <span class="va">na.rm</span>
  <span class="op">}</span>
  
  <span class="fu">add_two</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, na.rm <span class="op">=</span> <span class="va">na_rm</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="reducing-allowed-inputs-to-an-argument" class="section level3">
<h3 class="hasAnchor">
<a href="#reducing-allowed-inputs-to-an-argument" class="anchor"></a>Reducing allowed inputs to an argument</h3>
<p>To narrow the set of allowed inputs, call <code><a href="../reference/deprecate_soft.html">deprecate_warn()</a></code> only when the user supplies the previously supported inputs. Make sure you preserve the previous behaviour:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">add_two</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="../reference/deprecate_soft.html">deprecate_warn</a></span><span class="op">(</span><span class="st">"1.0.0"</span>, <span class="st">"foo(y = 'must be a scalar')"</span><span class="op">)</span>
    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">x</span> <span class="op">+</span> <span class="va">y</span>
<span class="op">}</span>

<span class="fu">add_two</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; [1] 3</span>
<span class="fu">add_two</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>
<span class="co">#&gt; Warning: The `y` argument of `foo()` must be a scalar as of lifecycle 1.0.0.</span>
<span class="co">#&gt; [1] 16</span></code></pre></div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>We only use an explicit <code>@description</code> when the description will be multiple paragraphs, as in these examples.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>You can learn more about snapshot testing in <code>vignette("snapshot", package = "testthat")</code>.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lionel Henry, <a href="http://hadley.nz">Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
